<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Stock Predictor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a0ca3;
            --secondary: #4cc9f0;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --gray: #6c757d;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 24px;
        }
        
        .auth-buttons button {
            background-color: white;
            color: var(--primary);
            border: none;
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .auth-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
            margin-top: 30px;
        }
        
        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }
        
        .dashboard {
            display: none;
            width: 100%;
        }
        
        .chart-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .chart-tab {
            padding: 8px 15px;
            background: var(--light);
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .chart-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .prediction-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .prediction-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stock-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stock-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .prediction-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .confidence-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Form styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        button {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        
        /* Auth sections */
        .auth-section {
            width: 100%;
            max-width: 500px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .prediction-cards {
                grid-template-columns: 1fr;
            }
        }
        
        /* Tooltip styles */
        .chart-tooltip {
            background: rgba(0, 0, 0, 0.8) !important;
            border-radius: 8px !important;
            padding: 10px 15px !important;
            border: none !important;
        }
        
        /* Zoom controls */
        .chart-zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            gap: 5px;
        }
        
        .zoom-btn {
            background: white;
            border: 1px solid #e0e0e0;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">ðŸ“ˆ</span>
                <h1>Advanced Stock Predictor</h1>
            </div>
            <div class="auth-buttons" id="authButtons">
                <button id="loginBtn">Login</button>
                <button id="registerBtn">Register</button>
            </div>
            <div class="user-section" id="userSection" style="display: none;">
                <div class="user-avatar" id="userAvatar">JD</div>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Auth Sections -->
        <div class="auth-section" id="loginSection">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">Welcome Back</h2>
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit">Login</button>
                <div style="text-align: center; margin-top: 20px;">
                    <span style="color: var(--gray);">Don't have an account? </span>
                    <a href="#" id="showRegister" style="color: var(--primary); text-decoration: none; font-weight: 500;">Sign up</a>
                </div>
            </form>
        </div>
        
        <div class="auth-section" id="registerSection" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">Create Account</h2>
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required placeholder="Create a password">
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" required placeholder="Confirm your password">
                </div>
                <button type="submit">Register</button>
                <div style="text-align: center; margin-top: 20px;">
                    <span style="color: var(--gray);">Already have an account? </span>
                    <a href="#" id="showLogin" style="color: var(--primary); text-decoration: none; font-weight: 500;">Login</a>
                </div>
            </form>
        </div>
        
        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <div class="main-content">
                <div class="sidebar">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">Stock Prediction</h3>
                    <div class="form-group">
                        <label for="stockSymbol">Company</label>
                        <select id="stockSymbol">
                            <option value="AAPL">Apple Inc. (AAPL)</option>
                            <option value="MSFT">Microsoft (MSFT)</option>
                            <option value="GOOGL">Alphabet (GOOGL)</option>
                            <option value="AMZN">Amazon (AMZN)</option>
                            <option value="TSLA">Tesla (TSLA)</option>
                            <option value="META">Meta (META)</option>
                            <option value="NFLX">Netflix (NFLX)</option>
                            <option value="NVDA">NVIDIA (NVDA)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeHorizon">Prediction Period</label>
                        <select id="timeHorizon">
                            <option value="1">1 day</option>
                            <option value="7">1 week</option>
                            <option value="30" selected>1 month</option>
                            <option value="90">3 months</option>
                            <option value="180">6 months</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="modelType">Prediction Model</label>
                        <select id="modelType">
                            <option value="lstm">LSTM Neural Network</option>
                            <option value="random_forest">Random Forest</option>
                            <option value="svm">Support Vector Machine</option>
                            <option value="prophet">Facebook Prophet</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="chartType">Chart Type</label>
                        <select id="chartType">
                            <option value="line">Line Chart</option>
                            <option value="candlestick">Candlestick</option>
                            <option value="area">Area Chart</option>
                        </select>
                    </div>
                    
                    <button id="predictButton">
                        <span id="buttonText">Predict Stock Price</span>
                        <span id="buttonLoader" style="display: none;">Predicting...</span>
                    </button>
                    <div class="loader" id="loader" style="display: none;"></div>
                </div>
                
                <div class="dashboard-content">
                    <div class="chart-tabs">
                        <div class="chart-tab active" data-tab="price">Price Chart</div>
                        <div class="chart-tab" data-tab="volume">Volume</div>
                        <div class="chart-tab" data-tab="rsi">RSI</div>
                        <div class="chart-tab" data-tab="macd">MACD</div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-zoom-controls">
                            <button class="zoom-btn" id="zoomIn">+</button>
                            <button class="zoom-btn" id="zoomOut">-</button>
                            <button class="zoom-btn" id="resetZoom">â†»</button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="prediction-cards">
                        <div class="prediction-card">
                            <div class="card-header">
                                <div class="stock-info">
                                    <div class="stock-icon" id="currentStockIcon">A</div>
                                    <div>
                                        <h4 id="currentStockName">Apple Inc.</h4>
                                        <span id="currentStockSymbol">AAPL</span>
                                    </div>
                                </div>
                                <span class="confidence-badge" id="confidenceBadge">85% confidence</span>
                            </div>
                            <div class="prediction-value">$<span id="predictedPrice">185.42</span></div>
                            <div style="color: var(--gray); font-size: 14px;">
                                Predicted price for <span id="resultTimeHorizon">1 month</span>
                            </div>
                            <div style="margin-top: 15px; font-size: 14px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: var(--gray);">Current Price:</span>
                                    <span id="currentPrice">$182.34</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: var(--gray);">Potential Change:</span>
                                    <span id="potentialChange" style="color: var(--success);">+1.69%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--gray);">Last Updated:</span>
                                    <span id="predictionTime">Just now</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="prediction-card">
                            <h4 style="margin-bottom: 15px;">Model Performance</h4>
                            <div style="height: 150px;">
                                <canvas id="performanceChart"></canvas>
                            </div>
                            <div style="margin-top: 15px; font-size: 14px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: var(--gray);">Accuracy:</span>
                                    <span id="modelAccuracy">85.2%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--gray);">Training Date:</span>
                                    <span>2023-10-15</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="prediction-card">
                            <h4 style="margin-bottom: 15px;">Market Sentiment</h4>
                            <div style="height: 150px;">
                                <canvas id="sentimentChart"></canvas>
                            </div>
                            <div style="margin-top: 15px; font-size: 14px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: var(--gray);">Bullish:</span>
                                    <span style="color: var(--success);">62%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--gray);">Bearish:</span>
                                    <span style="color: var(--danger);">38%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // User Authentication System
        const users = JSON.parse(localStorage.getItem('stockUsers')) || [];
        let currentUser = null;

        // DOM Elements
        const authButtons = document.getElementById('authButtons');
        const userSection = document.getElementById('userSection');
        const userAvatar = document.getElementById('userAvatar');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginSection = document.getElementById('loginSection');
        const registerSection = document.getElementById('registerSection');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const dashboard = document.getElementById('dashboard');

        // Stock Prediction Elements
        const predictButton = document.getElementById('predictButton');
        const buttonText = document.getElementById('buttonText');
        const buttonLoader = document.getElementById('buttonLoader');
        const loader = document.getElementById('loader');
        const currentStockIcon = document.getElementById('currentStockIcon');
        const currentStockName = document.getElementById('currentStockName');
        const currentStockSymbol = document.getElementById('currentStockSymbol');
        const predictedPrice = document.getElementById('predictedPrice');
        const confidenceBadge = document.getElementById('confidenceBadge');
        const resultTimeHorizon = document.getElementById('resultTimeHorizon');
        const currentPrice = document.getElementById('currentPrice');
        const potentialChange = document.getElementById('potentialChange');
        const predictionTime = document.getElementById('predictionTime');
        const modelAccuracy = document.getElementById('modelAccuracy');

        // Chart Elements
        const mainChartCtx = document.getElementById('mainChart').getContext('2d');
        const performanceChartCtx = document.getElementById('performanceChart').getContext('2d');
        const sentimentChartCtx = document.getElementById('sentimentChart').getContext('2d');
        let mainChart, performanceChart, sentimentChart;
        let currentTab = 'price';

        // Chart tabs
        const chartTabs = document.querySelectorAll('.chart-tab');
        chartTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                chartTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
                updateMainChart();
            });
        });

        // Zoom controls
        document.getElementById('zoomIn').addEventListener('click', () => {
            if (mainChart) mainChart.zoom(1.1);
        });
        document.getElementById('zoomOut').addEventListener('click', () => {
            if (mainChart) mainChart.zoom(0.9);
        });
        document.getElementById('resetZoom').addEventListener('click', () => {
            if (mainChart) mainChart.resetZoom();
        });

        // Mock Stock Data with more details
        const stockData = {
            AAPL: { 
                name: "Apple Inc.", 
                currentPrice: 185.25, 
                historical: generateHistoricalData(185.25, 0.02),
                volume: generateVolumeData(10000000),
                rsi: generateIndicatorData(30, 70, 0.5),
                macd: generateMACDData()
            },
            MSFT: { 
                name: "Microsoft", 
                currentPrice: 330.12, 
                historical: generateHistoricalData(330.12, 0.015),
                volume: generateVolumeData(15000000),
                rsi: generateIndicatorData(30, 70, 0.6),
                macd: generateMACDData()
            },
            GOOGL: { 
                name: "Alphabet", 
                currentPrice: 138.45, 
                historical: generateHistoricalData(138.45, 0.018),
                volume: generateVolumeData(8000000),
                rsi: generateIndicatorData(30, 70, 0.55),
                macd: generateMACDData()
            },
            AMZN: { 
                name: "Amazon", 
                currentPrice: 145.67, 
                historical: generateHistoricalData(145.67, 0.022),
                volume: generateVolumeData(12000000),
                rsi: generateIndicatorData(30, 70, 0.45),
                macd: generateMACDData()
            },
            TSLA: { 
                name: "Tesla", 
                currentPrice: 245.89, 
                historical: generateHistoricalData(245.89, 0.03),
                volume: generateVolumeData(20000000),
                rsi: generateIndicatorData(30, 70, 0.65),
                macd: generateMACDData()
            },
            META: { 
                name: "Meta", 
                currentPrice: 310.45, 
                historical: generateHistoricalData(310.45, 0.025),
                volume: generateVolumeData(18000000),
                rsi: generateIndicatorData(30, 70, 0.5),
                macd: generateMACDData()
            },
            NFLX: { 
                name: "Netflix", 
                currentPrice: 410.32, 
                historical: generateHistoricalData(410.32, 0.028),
                volume: generateVolumeData(5000000),
                rsi: generateIndicatorData(30, 70, 0.4),
                macd: generateMACDData()
            },
            NVDA: { 
                name: "NVIDIA", 
                currentPrice: 460.77, 
                historical: generateHistoricalData(460.77, 0.035),
                volume: generateVolumeData(25000000),
                rsi: generateIndicatorData(30, 70, 0.7),
                macd: generateMACDData()
            }
        };

        // Generate more realistic mock data
        function generateHistoricalData(currentPrice, volatility) {
            const data = [];
            const days = 365;
            let price = currentPrice;
            
            for (let i = days; i >= 0; i--) {
                // More realistic price movement with momentum
                const change = (Math.random() - 0.45) * volatility * (1 + Math.sin(i/30) * 0.3);
                price = price * (1 + change);
                
                // Generate OHLC data for candlestick charts
                const open = price;
                const high = open * (1 + Math.abs(change * 1.5));
                const low = open * (1 - Math.abs(change * 1.2));
                const close = open * (1 + (change * 0.8));
                
                data.unshift({
                    date: new Date(Date.now() - i * 24 * 60 * 60 * 1000),
                    price: parseFloat(price.toFixed(2)),
                    open: parseFloat(open.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    close: parseFloat(close.toFixed(2))
                });
            }
            
            return data;
        }
        
        function generateVolumeData(baseVolume) {
            const volumes = [];
            for (let i = 0; i < 365; i++) {
                volumes.push(Math.floor(baseVolume * (0.8 + Math.random() * 0.4)));
            }
            return volumes;
        }
        
        function generateIndicatorData(min, max, trend) {
            const data = [];
            let value = min + (max - min) * Math.random();
            for (let i = 0; i < 365; i++) {
                value = Math.min(max, Math.max(min, value + (Math.random() - 0.5 + trend * 0.1)));
                data.push(parseFloat(value.toFixed(2)));
            }
            return data;
        }
        
        function generateMACDData() {
            const macd = [];
            const signal = [];
            const histogram = [];
            
            let macdValue = 0;
            let signalValue = 0;
            
            for (let i = 0; i < 365; i++) {
                macdValue = macdValue * 0.9 + (Math.random() - 0.45) * 2;
                signalValue = signalValue * 0.95 + macdValue * 0.05;
                
                macd.push(parseFloat(macdValue.toFixed(2)));
                signal.push(parseFloat(signalValue.toFixed(2)));
                histogram.push(parseFloat((macdValue - signalValue).toFixed(2)));
            }
            
            return { macd, signal, histogram };
        }

        // Initialize charts
        function initCharts() {
            // Main chart
            mainChart = new Chart(mainChartCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Price',
                        data: [],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        zoom: {
                            zoom: {
                                wheel: {
                                    enabled: true,
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'xy',
                            },
                            pan: {
                                enabled: true,
                                mode: 'xy',
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += '$' + context.parsed.y.toFixed(2);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                },
                plugins: [ChartZoom]
            });
            
            // Performance chart
            performanceChart = new Chart(performanceChartCtx, {
                type: 'bar',
                data: {
                    labels: ['LSTM', 'Random Forest', 'SVM', 'Prophet'],
                    datasets: [{
                        label: 'Accuracy (%)',
                        data: [85.2, 82.7, 79.3, 81.5],
                        backgroundColor: [
                            'rgba(67, 97, 238, 0.7)',
                            'rgba(67, 97, 238, 0.7)',
                            'rgba(67, 97, 238, 0.7)',
                            'rgba(67, 97, 238, 0.7)'
                        ],
                        borderColor: [
                            'rgba(67, 97, 238, 1)',
                            'rgba(67, 97, 238, 1)',
                            'rgba(67, 97, 238, 1)',
                            'rgba(67, 97, 238, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + '% accuracy';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Sentiment chart
            sentimentChart = new Chart(sentimentChartCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Bullish', 'Bearish', 'Neutral'],
                    datasets: [{
                        data: [62, 38, 10],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(231, 76, 60, 0.7)',
                            'rgba(149, 165, 166, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(149, 165, 166, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update main chart based on current tab
        function updateMainChart() {
            const symbol = document.getElementById('stockSymbol').value;
            const data = stockData[symbol];
            const labels = data.historical.map(item => item.date.toLocaleDateString());
            
            mainChart.data.labels = labels;
            
            switch(currentTab) {
                case 'price':
                    mainChart.config.type = document.getElementById('chartType').value;
                    mainChart.data.datasets = [{
                        label: 'Price',
                        data: data.historical.map(item => item.price),
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: mainChart.config.type === 'area',
                        pointRadius: 0
                    }];
                    break;
                    
                case 'volume':
                    mainChart.config.type = 'bar';
                    mainChart.data.datasets = [{
                        label: 'Volume',
                        data: data.volume,
                        backgroundColor: 'rgba(76, 175, 80, 0.6)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }];
                    break;
                    
                case 'rsi':
                    mainChart.config.type = 'line';
                    mainChart.data.datasets = [
                        {
                            label: 'RSI',
                            data: data.rsi,
                            borderColor: '#4361ee',
                            backgroundColor: 'rgba(67, 97, 238, 0.1)',
                            borderWidth: 2,
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'Overbought (70)',
                            data: Array(data.rsi.length).fill(70),
                            borderColor: '#e74c3c',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Oversold (30)',
                            data: Array(data.rsi.length).fill(30),
                            borderColor: '#2ecc71',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ];
                    break;
                    
                case 'macd':
                    mainChart.config.type = 'line';
                    mainChart.data.datasets = [
                        {
                            label: 'MACD',
                            data: data.macd.macd,
                            borderColor: '#4361ee',
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: 'Signal',
                            data: data.macd.signal,
                            borderColor: '#f39c12',
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: 'Histogram',
                            data: data.macd.histogram,
                            type: 'bar',
                            backgroundColor: data.macd.histogram.map(val => 
                                val >= 0 ? 'rgba(46, 204, 113, 0.7)' : 'rgba(231, 76, 60, 0.7)'
                            ),
                            borderColor: data.macd.histogram.map(val => 
                                val >= 0 ? 'rgba(46, 204, 113, 1)' : 'rgba(231, 76, 60, 1)'
                            ),
                            borderWidth: 1
                        }
                    ];
                    break;
            }
            
            mainChart.update();
        }

        // Check if user is already logged in
        function checkLoginStatus() {
            const loggedInUser = localStorage.getItem('stockCurrentUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                showDashboard();
            }
        }

        // User authentication functions
        function loginUser(email, password) {
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('stockCurrentUser', JSON.stringify(user));
                showDashboard();
                loginForm.reset();
                loginSection.style.display = 'none';
            } else {
                showAlert('Invalid email or password', 'error');
            }
        }

        function registerUser(name, email, password, confirmPassword) {
            if (password !== confirmPassword) {
                showAlert('Passwords do not match', 'error');
                return;
            }
            
            if (users.some(u => u.email === email)) {
                showAlert('Email already registered', 'error');
                return;
            }
            
            const newUser = { 
                name, 
                email, 
                password,
                initials: name.split(' ').map(n => n[0]).join('').toUpperCase()
            };
            users.push(newUser);
            localStorage.setItem('stockUsers', JSON.stringify(users));
            
            showAlert('Registration successful! Please login.', 'success');
            registerForm.reset();
            
            setTimeout(() => {
                registerSection.style.display = 'none';
                loginSection.style.display = 'block';
            }, 2000);
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('stockCurrentUser');
            hideDashboard();
        }

        function showDashboard() {
            authButtons.style.display = 'none';
            userSection.style.display = 'flex';
            userAvatar.textContent = currentUser.initials;
            dashboard.style.display = 'block';
            loginSection.style.display = 'none';
            registerSection.style.display = 'none';
            
            // Initialize charts
            initCharts();
            updateMainChart();
            
            // Set default stock
            updateStockInfo('AAPL');
        }

        function hideDashboard() {
            authButtons.style.display = 'block';
            userSection.style.display = 'none';
            dashboard.style.display = 'none';
            loginSection.style.display = 'block';
        }

        function updateStockInfo(symbol) {
            const stock = stockData[symbol];
            currentStockIcon.textContent = symbol[0];
            currentStockName.textContent = stock.name;
            currentStockSymbol.textContent = symbol;
            currentPrice.textContent = '$' + stock.currentPrice.toFixed(2);
        }

        // Show alert message
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.padding = '15px 20px';
            alertDiv.style.borderRadius = '8px';
            alertDiv.style.color = 'white';
            alertDiv.style.fontWeight = '500';
            alertDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.animation = 'slideIn 0.3s ease-out';
            
            if (type === 'error') {
                alertDiv.style.backgroundColor = 'var(--danger)';
            } else if (type === 'success') {
                alertDiv.style.backgroundColor = 'var(--success)';
            } else {
                alertDiv.style.backgroundColor = 'var(--gray)';
            }
            
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                }, 300);
            }, 3000);
        }

        // Stock prediction function
        async function predictStockPrice() {
            const symbol = document.getElementById('stockSymbol').value;
            const days = parseInt(document.getElementById('timeHorizon').value);
            const model = document.getElementById('modelType').value;
            
            // Show loading state
            buttonText.style.display = 'none';
            buttonLoader.style.display = 'inline';
            predictButton.disabled = true;
            
            try {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const stock = stockData[symbol];
                const currentPrice = stock.currentPrice;
                const volatility = 0.02 + Math.random() * 0.03;
                
                // Different models have different "accuracy"
                let modelFactor = 1;
                let confidence = 70;
                
                switch(model) {
                    case 'lstm':
                        modelFactor = 1 + (Math.random() * 0.1 - 0.05);
                        confidence = 75 + Math.random() * 15;
                        break;
                    case 'random_forest':
                        modelFactor = 1 + (Math.random() * 0.08 - 0.04);
                        confidence = 70 + Math.random() * 10;
                        break;
                    case 'svm':
                        modelFactor = 1 + (Math.random() * 0.06 - 0.03);
                        confidence = 65 + Math.random() * 10;
                        break;
                    case 'prophet':
                        modelFactor = 1 + (Math.random() * 0.07 - 0.035);
                        confidence = 72 + Math.random() * 12;
                        break;
                }
                
                // Calculate predicted price
                const dailyChange = volatility * (Math.random() - 0.3);
                const predictedValue = currentPrice * Math.pow(1 + dailyChange, days) * modelFactor;
                const percentageChange = ((predictedValue - currentPrice) / currentPrice * 100).toFixed(2);
                
                // Update UI
                predictedPrice.textContent = predictedValue.toFixed(2);
                confidenceBadge.textContent = confidence.toFixed(0) + '% confidence';
                
                let timeText = '';
                if (days === 1) timeText = '1 day';
                else if (days === 7) timeText = '1 week';
                else if (days === 30) timeText = '1 month';
                else if (days === 90) timeText = '3 months';
                else if (days === 180) timeText = '6 months';
                
                resultTimeHorizon.textContent = timeText;
                potentialChange.textContent = (percentageChange >= 0 ? '+' : '') + percentageChange + '%';
                potentialChange.style.color = percentageChange >= 0 ? 'var(--success)' : 'var(--danger)';
                predictionTime.textContent = new Date().toLocaleString();
                modelAccuracy.textContent = (confidence + Math.random() * 5).toFixed(1) + '%';
                
                // Update performance chart to highlight selected model
                performanceChart.data.datasets[0].backgroundColor = ['LSTM', 'Random Forest', 'SVM', 'Prophet'].map(m => 
                    m.toLowerCase() === model ? 'rgba(76, 175, 80, 0.7)' : 'rgba(67, 97, 238, 0.7)'
                );
                performanceChart.update();
                
                // Update sentiment chart randomly
                const bullish = 50 + Math.random() * 30;
                const bearish = 100 - bullish - Math.random() * 10;
                sentimentChart.data.datasets[0].data = [bullish, bearish, 100 - bullish - bearish];
                sentimentChart.update();
                
                // Add prediction point to main chart
                const lastDate = stock.historical[stock.historical.length - 1].date;
                const predictionDate = new Date(lastDate);
                predictionDate.setDate(predictionDate.getDate() + days);
                
                if (mainChart.data.datasets.length === 1 || currentTab !== 'price') {
                    mainChart.data.datasets.push({
                        label: 'Predicted Price',
                        data: Array(mainChart.data.labels.length - 1).fill(null).concat([
                            stock.historical[stock.historical.length - 1].price,
                            parseFloat(predictedValue.toFixed(2))
                        ]),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderDash: [5, 5],
                        pointBackgroundColor: '#10b981',
                        pointRadius: [0, 0, 6],
                        tension: 0.1
                    });
                    
                    mainChart.data.labels.push(predictionDate.toLocaleDateString());
                } else {
                    mainChart.data.datasets[1].data = Array(mainChart.data.labels.length - 2).fill(null).concat([
                        stock.historical[stock.historical.length - 1].price,
                        parseFloat(predictedValue.toFixed(2))
                    ]);
                    mainChart.data.labels[mainChart.data.labels.length - 1] = predictionDate.toLocaleDateString();
                }
                
                mainChart.update();
                
            } catch (error) {
                showAlert('Error generating prediction', 'error');
            } finally {
                buttonText.style.display = 'inline';
                buttonLoader.style.display = 'none';
                predictButton.disabled = false;
            }
        }

        // Event listeners
        loginBtn.addEventListener('click', () => {
            loginSection.style.display = 'block';
            registerSection.style.display = 'none';
        });

        registerBtn.addEventListener('click', () => {
            registerSection.style.display = 'block';
            loginSection.style.display = 'none';
        });

        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            registerSection.style.display = 'block';
            loginSection.style.display = 'none';
        });

        showLogin.addEventListener('click', (e) => {
            e.preventDefault();
            loginSection.style.display = 'block';
            registerSection.style.display = 'none';
        });

        logoutBtn.addEventListener('click', logout);

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            loginUser(email, password);
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            registerUser(name, email, password, confirmPassword);
        });

        predictButton.addEventListener('click', predictStockPrice);

        document.getElementById('stockSymbol').addEventListener('change', function() {
            const symbol = this.value;
            updateStockInfo(symbol);
            updateMainChart();
        });

        document.getElementById('chartType').addEventListener('change', updateMainChart);

        // Check login status on page load
        checkLoginStatus();

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>